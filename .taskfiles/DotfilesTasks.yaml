version: "3"

tasks:
  setup:
    cmds:
      - task: restore
      - task: fish
      - task: tmux

  restore:
    desc: "Check preconditions and restore dotfiles"
    preconditions:
      - command -v tmux &> /dev/null
      - command -v fish &> /dev/null
      - command -v python3 &> /dev/null
      - command -v batcat &> /dev/null
      - command -v exa &> /dev/null
      - command -v k9s &> /dev/null
      - command -v direnv &> /dev/null
      - command -v mackup &> /dev/null
      - command -v starship &> /dev/null
      - command -v alacritty &> /dev/null
      - command -v thefuck &> /dev/null
    cmds:
      - mackup restore

  fish:
    desc: "Setup fish shell"
    cmds:
      - chsh -s $(which fish)
      - curl -sL https://raw.githubusercontent.com/jorgebucaran/fisher/main/functions/fisher.fish | fish
      - fish -c 'fisher install jorgebucaran/fisher'
      - fish -c 'fisher update'

  tmux:
    desc: "Setup tmux"
    preconditions:
      - sh: "test -f  ~/.tmux/plugins/tpm"
    cmds:
      - git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
